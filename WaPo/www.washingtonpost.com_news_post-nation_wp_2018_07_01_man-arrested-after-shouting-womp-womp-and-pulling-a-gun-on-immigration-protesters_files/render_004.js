(function($){function InStreamNewsletter(rootSelector,unitType){var self=this;self.rootSelector=rootSelector;self.unitType=unitType;self.mainNewsletter,self.recommendations;var defaultNewsLetter={frequency:"Daily",headline:"Get the Today's Headlines Newsletter",id:"post_newsletter1",name:"Today's Headlines",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-heads",variable:"vars[intent_heads]"},defaultNewsLetters=[{frequency:"Daily",headline:"Get the Today's Headlines Newsletter",
id:"post_newsletter1",name:"Today's Headlines",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-heads",variable:"vars[intent_heads]"},{frequency:"Daily",headline:"Get the Read In Newsletter",id:"post_newsletter112",name:"Read In",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-readin",variable:"vars[intent_readin]"},{frequency:"Weekly",headline:"Get the Lean \x26 Fit Newsletter",id:"post_newsletter8",name:"Lean \x26 Fit",tagline:"Free weekly updates delivered just for you.",
template:"signup-confirm-lean",variable:"vars[intent_lean]"},{frequency:"Twice-weekly",headline:"Get the Checkpoint Newsletter",id:"post_newsletter130",name:"Checkpoint",tagline:"Free twice-weekly updates delivered just for you.",template:"signup-confirm-check",variable:"vars[intent_check]"}],democraticDebateNewsletter={headline:"Sign up for a debate reminder -",blurb:"and election news as it breaks",id:"post_newsletter32"},electionLiveblogNewsletter1={headline:"Get the Fact Checker newsletter",blurb:"Get our weekly review of what's true, false or in-between delivered to your inbox.",
id:"post_newsletter169",name:"Fact Checker"},electionLiveblogNewsletters=[{headline:"Get Campaign 2016 updates",blurb:"Get our best analysis of the presidential race by email",id:"post_newsletter323",name:" Campaign 2016 updates"},{headline:"Get The Daily 202 newsletter",blurb:"",id:"post_newsletter156",name:"Daily 202"}],electionLiveblogNewsletter2={headline:"Get The 5-Minute Fix newsletter",blurb:"Get quick-hit analysis on the political news you need to know delivered to your inbox.",id:"post_newsletter45",
name:"The 5-Minute Fix"},defaultUserSegmentFlags='{"userid":"","geoLoc":{"region":"DC","zip":"20007","city":"Washington","country":"USA"},"segmentsFlag":{"2281234048":false,"2582021445":false,"3605630552":false,"7978704408":null,"9013442807":false,"5497328667":null,"7688613820":true},"updated":"2016-02-03T17:39:31.439Z"}',washPostId="",subscribeEmail,wp_pb=window.wp_pb||{},env=wp_pb.environment||"production",shownInViewPort=false,showInStreamNewsletter=function(){if(unitType==InStreamNewsletterUnit.primetimeLiveblog||
unitType==InStreamNewsletterUnit.electionLiveblog1){if($(".liveblog-stream").length>0&&$(".liveblog-post").filter(":visible").length<3){$(rootSelector).addClass("hidden");return false}var post=$(".liveblog-stream").find(".liveblog-post").filter(":visible")[2];$(post).after($(".pb-f-page-newsletter-inStream"))}else if(unitType==InStreamNewsletterUnit.electionLiveblog2){if($(".liveblog-stream").length>0&&$(".liveblog-post").filter(":visible").length<=6){$(rootSelector).addClass("hidden");return false}post=
$(".liveblog-stream").find(".liveblog-post").filter(":visible")[5];$(post).after($(rootSelector).parent())}$(rootSelector).show()},hideInStreamNewsletter=function(){$(rootSelector).hide();$(rootSelector).parent().hide()},showInStreamSignUpForm=function(){$(rootSelector).find("#subscribe-form-inStream").show();$(rootSelector).find("#loggedInBtn").hide()},showInStreamSignUpButton=function(){$(rootSelector).find("#subscribe-form-inStream").hide();$(rootSelector).find("#loggedInBtn").show()},showErrorMsgInStream=
function(message){if(message)$(rootSelector).find(".error-msg-inStream").text(message).show()},hideErrorMsgInStream=function(){$(rootSelector).find(".error-msg-inStream").hide()},setInStreamNewsLetter=function(data){$(rootSelector).find(".headline-instream:not(.thank-you)").text(data.headline);$(rootSelector).find(".tagline-instream:not(.thank-you)").text(data.blurb);if($(rootSelector).find("#headline-instream-thank-you").length>0)$(rootSelector).find("#headline-instream-thank-you").text(data.headline.replace(" newsletter",
""))},setInStreamRecommendations=function(data){$(rootSelector).find("#suggestions-inStream .recommended").each(function(index){if(data[index]){$(this).find("p").text(data[index].headline);$(this).find("input[type\x3d'checkbox']").attr("value",data[index].id);$(this).find("input[type\x3d'checkbox']").attr("name",data[index].name)}else $(this).hide()})},toggleInStreamRecommendations=function(show){if(show){$(rootSelector).find("#subscribe-form-inStream, #loggedInBtn, #tagline-instream:not(.thank-you)").hide();
$(rootSelector).find("#suggestions-inStream, .checked-icon, #confirmation-instream, #all-newsletters-inStream").show()}else $(rootSelector).find("#suggestions-inStream, .might-like").hide()},showConfirmationInStream=function(){var hideSel="",showSel="";$(rootSelector).closest(".pb-f-page-newsletter-inStream").addClass("thank-you-wrapper");if($(rootSelector).hasClass("bottomArticle")){hideSel="#subscribe-form-inStream, #loggedInBtn, #headline-instream:not(.thank-you), #tagline-instream:not(.thank-you)";
showSel="#headline-instream.thank-you, #tagline-instream.thank-you"}else{hideSel="#subscribe-form-inStream, #loggedInBtn, #tagline-instream";showSel=".checked-icon, #confirmation-instream, #all-newsletters-inStream"}$(rootSelector).find(hideSel).hide();$(rootSelector).find(showSel).show()},getUserId=function(){return document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:""},getWapoId=function(){return document.cookie.match(/wapo_secure_login_id=([^;]+)/)?RegExp.$1:""},getPageData=function(){var section=
$(rootSelector).find("#section-instream").text(),subSection=$(rootSelector).find("#subsection-instream").text(),blog=$(rootSelector).find("#blogname-instream").text(),data={};washPostId=getUserId();if(unitType==InStreamNewsletterUnit.primetimeLiveblog||unitType==InStreamNewsletterUnit.electionLiveblog1||unitType==InStreamNewsletterUnit.electionLiveblog2){section=section.charAt(0)=="/"?section.split("/")[1]:section;subSection=subSection.charAt(0)=="/"?subSection.split("/")[1]:subSection}if(unitType==
InStreamNewsletterUnit.politicsPanel||unitType==InStreamNewsletterUnit.politicsPanel2){data.module="elections-2016";if(localStorage.getItem("usersegments"))data.userSegmentFlags=JSON.parse(localStorage.getItem("usersegments"));else data.userSegmentFlags=JSON.parse(defaultUserSegmentFlags)}if(washPostId!=="")data.washPostId=washPostId;if(blog)data.blog=blog;if(subSection)data.subSection=subSection;if(section)data.section=section;return data},getInStreamNewsletter=function(){var data=getPageData(),
url="https://recommendation-newsletter.wpdigital.net/Newsletter/api/newsletter";return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data)})},getInStreamRecommendations=function(newsletters){var data=getPageData(),url="https://recommendation-newsletter.wpdigital.net/Newsletter/api/newsletters";data.newsletters=newsletters;return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data)})},subscribeInStream=
function(email,recaptchaToken){var data,url;if(washPostId!==""){if(env=="production")url="https://subscribe.washingtonpost.com/person/newsletter/subscribe";else url="https://subscribe.digitalink.com/person/newsletter/subscribe";data={wapoLoginID:washPostId,wapoSecureID:getWapoId(),userAgent:navigator.userAgent,newsletterName:self.mainNewsletter.id,metadata:[{name:"nl_start_method",value:"EI"},{name:"nl_start_location",value:"IS"}]};if(recaptchaToken)data["recaptchaResponse"]=recaptchaToken}else if(email){if(env==
"production")url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-email";else url="https://subscribe.digitalink.com/person/newsletter/subscribe-email";data={email:email,newsletterName:self.mainNewsletter.id,metadata:[{name:"nl_start_method",value:"EI"},{name:"nl_start_location",value:"IS"}]};if(recaptchaToken)data["recaptchaResponse"]=recaptchaToken}if(unitType==InStreamNewsletterUnit.bottomArticle)data.metadata=[{name:"nl_start_method",value:"EI"},{name:"nl_start_location",value:"ART_ISB"}];
else if(unitType==InStreamNewsletterUnit.politicsPanel||unitType==InStreamNewsletterUnit.politicsPanel2)data.metadata=[{name:"nl_start_method",value:"EI"},{name:"nl_start_location",value:"PANL"}];else if(unitType==InStreamNewsletterUnit.democraticDebate)data.metadata=[{name:"nl_start_method",value:"SURL"},{name:"nl_start_location",value:"DEB"}];else if(unitType==InStreamNewsletterUnit.electionLiveblog1||unitType==InStreamNewsletterUnit.electionLiveblog2)data.metadata=[{name:"nl_start_method",value:"S"},
{name:"nl_start_location",value:"IS"}];$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data),success:function(data){if(data.status=="SUCCESS"){if(unitType==InStreamNewsletterUnit.democraticDebate||unitType==InStreamNewsletterUnit.electionLiveblog1)showConfirmationInStream();else if(unitType==InStreamNewsletterUnit.electionLiveblog2){self.recommendations=electionLiveblogNewsletters;setInStreamRecommendations(electionLiveblogNewsletters);toggleInStreamRecommendations(true)}else setUpInStreamRecommendations(self.mainNewsletter.id);
sendCustomTrackProps("event91",trackProps(self.mainNewsletter.name,1,"simple"),"Newsletter In Stream Sign-up")}else showErrorMsgInStream("Error while subscribing, please try later.")},error:function(){showErrorMsgInStream("Error while subscribing, please try later.")}})},subscribeBundleInStream=function(){var data,url,newsletters=[],newsletterNames=[];$(rootSelector).find("#suggestions-inStream input:checked").each(function(){if($(this).val()){newsletters.push($(this).val());newsletterNames.push({name:$(this).attr("name"),
position:$(this).attr("data-pos")})}});if(newsletters.length>0&&newsletterNames.length>0){if(washPostId!==""){if(env=="production")url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-list";else url="https://subscribe.digitalink.com/person/newsletter/subscribe-list";data={wapoLoginID:washPostId,wapoSecureID:getWapoId(),userAgent:navigator.userAgent,newsletters:newsletters,metadata:[{name:"nl_start_method",value:"EA"},{name:"nl_start_location",value:"IS"}]}}else if(subscribeEmail){if(env==
"production")url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-list-email";else url="https://subscribe.digitalink.com/person/newsletter/subscribe-list-email";data={email:subscribeEmail,newsletters:newsletters,metadata:[{name:"nl_start_method",value:"EA"},{name:"nl_start_location",value:"IS"}]}}if(unitType==InStreamNewsletterUnit.bottomArticle)data.metadata=[{name:"nl_start_method",value:"EA"},{name:"nl_start_location",value:"ISB"}];if(unitType==InStreamNewsletterUnit.politicsPanel||
unitType==InStreamNewsletterUnit.politicsPanel2)data.metadata=[{name:"nl_start_method",value:"EI"},{name:"nl_start_location",value:"PANL"}];$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data),success:function(data){if(data.status=="SUCCESS"){for(var i=0;i<newsletterNames.length;i++)sendCustomTrackProps("event91",trackProps(newsletterNames[i].name,newsletterNames[i].position,"enhanced"),"Newsletter In Stream Sign-up Bundle");setUpInStreamRecommendations(newsletters,
true);toggleInStreamRecommendations(false)}else showErrorMsgInStream("Error while subscribing, please try later.")},error:function(){showErrorMsgInStream("Error while subscribing, please try later.")}})}},setUpInStreamRecommendations=function(newsletterId,confirmBundleSubscribe){var recommendations=getInStreamRecommendations([newsletterId]);recommendations.done(function(data){if(!$.isEmptyObject(data.newsletters)&&data.newsletters.length>=1&&!confirmBundleSubscribe){self.recommendations=data.newsletters;
if(document.getElementById("suggestions-inStream")){setInStreamRecommendations(data.newsletters);toggleInStreamRecommendations(true);if(unitType!==InStreamNewsletterUnit.politicsPanel)for(var i=0;i<data.newsletters.length-1;i++)sendCustomTrackProps("event59",trackProps(data.newsletters[i+1].name,i+1,"enhanced"),"Newsletter In Stream Sign-up Show Recommendations")}}else toggleInStreamRecommendations(false);showConfirmationInStream()});recommendations.fail(function(){if(!confirmBundleSubscribe){self.recommendations=
defaultNewsLetters;setInStreamRecommendations(defaultNewsLetters);toggleInStreamRecommendations(true)}})},setUpInStreamNewsletter=function(newsletter){self.mainNewsletter=newsletter;setInStreamNewsLetter(newsletter);showInStreamNewsletter();if(getUserId()!=="")showInStreamSignUpButton();else showInStreamSignUpForm();attachOmnitureTracking(unitType)},applyInStream=function(){if(unitType==InStreamNewsletterUnit.democraticDebate){washPostId=getUserId();setUpInStreamNewsletter(democraticDebateNewsletter)}else if(unitType==
InStreamNewsletterUnit.electionLiveblog1){washPostId=getUserId();setUpInStreamNewsletter(electionLiveblogNewsletter1)}else if(unitType==InStreamNewsletterUnit.electionLiveblog2){washPostId=getUserId();setUpInStreamNewsletter(electionLiveblogNewsletter2)}else{var mainNewsletter=getInStreamNewsletter();mainNewsletter.done(function(data){if(!$.isEmptyObject(data.newsletter)){self.mainNewsletter=data.newsletter;setUpInStreamNewsletter(self.mainNewsletter)}else hideInStreamNewsletter()});mainNewsletter.fail(function(){self.mainNewsletter=
defaultNewsLetter;setUpInStreamNewsletter(defaultNewsLetter);sendCustomTrackProps("event50",trackProps(defaultNewsLetter.name,1),"Newsletter In Stream API failure case")})}if(typeof grecaptcha==="undefined")$.ajax({url:"https://www.google.com/recaptcha/api.js",dataType:"script",cache:true,success:function(){var findCaptcha=setInterval(function(){if(typeof grecaptcha!=="undefined")clearInterval(findCaptcha)},50)},error:function(){}});var captchaId;var email;var resetCaptcha=function(){if(captchaId)grecaptcha.reset();
$("#nlisrecaptchadiv").html("");captchaId=grecaptcha.render("nlisrecaptchadiv",{sitekey:"6Lf0DRoUAAAAAEawkoNEUKcpWx8eh_I7PRArTA9V",size:"invisible",callback:function(resp){$("#captchaDiv .text-success").show();setTimeout(function(){$("#captchaDiv .text-success").hide();$("#captchaDiv").hide()},5E3);subscribeInStream(email,resp)}})};var captchaInitialized=0;$(rootSelector).find("#email-inStream").click(function(){if(!captchaInitialized){captchaInitialized=1;resetCaptcha($(this).html())}});$(rootSelector).find("#subscribe-btn-inStream").click(function(e){var re;
e.preventDefault();subscribeEmail=$(rootSelector).find("#email-inStream").val(),re=/[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}/gim;if(subscribeEmail==""||!re.test(subscribeEmail))showErrorMsgInStream("Please enter a valid email address");else{hideErrorMsgInStream();email=subscribeEmail;grecaptcha.execute(captchaId)}return false});$(rootSelector).find("#loggedInBtn").off("click").click(function(){subscribeInStream()});$(rootSelector).find("#subscribe-bundle-inStream").off("click").click(function(){subscribeBundleInStream()});
$(rootSelector).find("#cancel-bundle-inStream").off("click").click(function(){sendCustomTrackProps("event58",trackProps(),"No Thanks, Newsletter In Stream Sign-up Bundle ");toggleInStreamRecommendations(false)})},attachOmnitureTracking=function(unitType){if(!shownInViewPort&&unitType);};applyInStream();function trackProps(newsletterName,index,enhancedKey){var subsection=window.wp_subsection||"";var contentType=window.wp_content_type||"";var channel=window.wp_channel||"";var props={eVar2:"wp - "+subsection,
prop2:"wp - "+subsection,prop3:contentType,eVar17:contentType,channel:channel};if($(rootSelector).hasClass("politicsPanel"))enhancedKey="nl_bkgd-campaign2016_"+enhancedKey;else if($(rootSelector).hasClass("inStreamSignUp"))enhancedKey="nl_instream_"+enhancedKey;else if($(rootSelector).hasClass("bottomArticle"))enhancedKey="nl_bottom_"+enhancedKey;if(newsletterName&&index)props.eVar26=enhancedKey+"_"+newsletterName.toLowerCase().split(" ").join("-")+"_"+index;return props}function sendCustomTrackProps(eventKey,
props,name){if(window.s)window.s.sendDataToOmniture(name||"PB Feature - Page-Newsletter",eventKey,props,{wait:true})}}var InStreamNewsletterUnit={bottomArticle:"bottomArticle",politicsPanel:"politicsPanel",politicsPanel2:"politicsPanel2",inStreamSignUp:"inStreamSignUp",democraticDebate:"democraticDebate",primetimeLiveblog:"primetimeLiveblog",electionLiveblog1:"electionLiveblog1",electionLiveblog2:"electionLiveblog2",articleLayout:"articleLayout",init:function(){var rootSelector,unitType;if($(".pb-f-page-newsletter-inStream .signup-box-instream.politicsPanel").length==
2){var second=$(".pb-f-page-newsletter-inStream .signup-box-instream.politicsPanel")[1];$(second).addClass("politicsPanel2")}$(".pb-f-page-newsletter-inStream .signup-box-instream").each(function(){if($(this).hasClass("politicsPanel")){rootSelector=".signup-box-instream.politicsPanel";unitType=InStreamNewsletterUnit.politicsPanel;if($(this).hasClass("politicsPanel2")){rootSelector=".signup-box-instream.politicsPanel2";unitType="politicsPanel2";$(this).removeClass("politicsPanel")}}else if($(this).hasClass("inStreamSignUp")){rootSelector=
".signup-box-instream.inStreamSignUp";unitType=InStreamNewsletterUnit.inStreamSignUp}else if($(this).hasClass("democraticDebate")){rootSelector=".signup-box-instream.democraticDebate";unitType=InStreamNewsletterUnit.democraticDebate}else if($(this).hasClass("primetimeLiveblog")){rootSelector=".signup-box-instream.primetimeLiveblog";unitType=InStreamNewsletterUnit.primetimeLiveblog}else if($(this).hasClass("electionLiveblog1")){rootSelector=".signup-box-instream.electionLiveblog1";unitType=InStreamNewsletterUnit.electionLiveblog1}else if($(this).hasClass("electionLiveblog2")){rootSelector=
".signup-box-instream.electionLiveblog2";unitType=InStreamNewsletterUnit.electionLiveblog2}else if($(this).hasClass("articleLayout")){rootSelector=".signup-box-instream.articleLayout";unitType=InStreamNewsletterUnit.articleLayout}else{$(this).addClass("bottomArticle");rootSelector=".signup-box-instream.bottomArticle";unitType=InStreamNewsletterUnit.bottomArticle}$(this).parent().addClass(unitType);new InStreamNewsletter(rootSelector,unitType)})}};if(wp_pb.StaticMethods.isPageHydrated())InStreamNewsletterUnit.init();
__e.push(["shamble",function(){InStreamNewsletterUnit.init()}])})(jQuery);